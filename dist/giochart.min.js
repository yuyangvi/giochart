!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("lodash"),require("react-dom"),require("G2"),require("antd"),require("moment")):"function"==typeof define&&define.amd?define(["react","lodash","react-dom","G2","antd","moment"],e):"object"==typeof exports?exports.GIO=e(require("react"),require("lodash"),require("react-dom"),require("G2"),require("antd"),require("moment")):t.GIO=e(t.React,t.lodash,t.ReactDOM,t.G2,t.antd,t.moment)}(this,function(t,e,r,o,n,a){return function(t){function e(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){t.exports=r(1)},function(t,e,r){"use strict";e.__esModule=!0;var o=r(2),n=r(3);e.Chart=n.default;var a=r(7);e.ContextListener=a.default;var i=r(11);e.DataSource=i.default;var s=r(8);e.GrTable=s.default;var c=function(t){return o.createElement(i.default,{params:t.params,style:t.style},o.createElement(a.default,{chartType:t.chartType,granularities:t.params.granularities,adjust:t.adjust}))},u=function(t){var e=t.metrics,r=t.dimensions||[],o=[];return t.chartType.includes("dimension")&&(o.push({id:r[0],top:t.top}),r.unshift("tm")),0===r.length&&r.unshift("bar"===t.chartType?"v":"tm"),r.includes("tm")&&o.unshift({id:"tm",interval:t.interval,period:"comparison"===t.chartType?t.period:void 0}),{aggregateType:"comparison"===t.chartType?t.aggregateType:void 0,dimensions:r,filter:t.filter,granularities:o,limit:t.top,metrics:e,orders:t.orders,timeRange:t.timeRange,userTag:t.userTag}};e.convertChartParams=u,e.default=c},function(e,r){e.exports=t},function(t,e,r){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();e.__esModule=!0;var n=r(4),a=r(2),i=r(5),s=r(6),c=function(t){var e={combinMetrics:!0,geom:"line"},r={area:{geom:"area"},bar:{geom:"interval",reflect:"y",transpose:!0},bubble:{geom:"point",pos:"MM",combinMetrics:!1},comparison:{geom:"area",style:{lineWidth:2}},doubley:{geom:"interval",pos:"DMM",combinMetrics:!1},funnel:{axis:!1,geom:"intervalSymmetric",transpose:!0,scale:!0,shape:"funnel"},line:{geom:"line",size:2},retension:{geom:"line",size:2,counter:"day"},vbar:{geom:"interval"}};return n.merge({},e,r[t])},u=function(t){function e(e){var r=t.call(this)||this;r.lastSelectedShape=null;var o=["#fc5f3a","#fa9d1b","#48a1f9","#9ecefe","#349a38","#7fd182","#d5375f","#ff8ba8","#3e4a9c","#8d9bf3","#525566","#a1a4b3","#25ada1","#8ae1d8","#755920","#dab873","#8d49a4","#da97f1","#f5d360","#ffbd9c"],n=s.Util.mix(!0,{},s.Theme,{animate:!1,axis:{bottom:{labels:{autoRotate:!1},title:null},left:{labels:{autoRotate:!1},title:null}},colors:{default:o,intervalStack:o},defaultColor:"#fc5f3a",shape:{area:{fill:"#fc5f3a"},interval:{fill:"#d5375f"},line:{stroke:"#fc5f3a"}}});return s.Global.setTheme(n),r}return o(e,t),e.prototype.render=function(){return a.createElement("div",{style:{height:"100%"}})},e.prototype.componentWillReceiveProps=function(t){if(t.source){var e=t.source;if(n.isEmpty(t.selected))n.isEqual(this.props.chartParams,t.chartParams)?this.changeData(e):(this.chart&&this.chart.destroy(),this.drawChart(t.chartParams,e));else{var r=n.map(n.filter(t.chartParams.columns,{isDim:!0}),"id"),o=n.filter(t.selected,function(t){return n.isEmpty(n.pick(t,r))});if(n.isEmpty(o))return;var a=n.filter(e,function(t){return n.some(o,function(e){return n.isMatch(t,e)})});this.changeData(a||e)}}},e.prototype.changeData=function(t){this.chart?this.chart.changeData(t):this.drawChart(this.props.chartParams,t)},e.prototype.componentDidMount=function(){var t=this.props,e=t.chartParams,r=t.source;this.props.source&&(this.chart&&this.chart.destroy(),this.drawChart(e,r))},e.prototype.componentWillUnmount=function(){this.chart&&this.chart.destroy()},e.prototype.drawChart=function(t,e){var r=this,o=document.createElement("div");o.style.height="100%",i.findDOMNode(this).appendChild(o);var a=o.getBoundingClientRect();if(!t.chartType)return void console.error("Error 101: 图表没有指定类型或类型不合法，请访问ChartParams.md获取类型定义的方案");var u=new s.Chart({container:o,forceFit:!0,height:a.height||350,plotCfg:{}}),p=this.buildSourceConfig(t),l=n.map(n.filter(t.columns,{isDim:!1}),"id"),f=n.map(n.filter(t.columns,{isDim:!0}),"id"),h=new s.Frame(e),d=c(t.chartType);if(d.combinMetrics&&l.length>1){h=s.Frame.combinColumns(h,l,"val","metric",f),f.push("metric");var m=n.fromPairs(n.zip(l,name)),y=h.colArray("metric"),v=y.map(function(t){return m[t]});h.colReplace("metric",v)}if(u.source(h,p),d.axis&&u.axis(d.axis),d.transpose){var g=u.coord("rect").transpose();d.reflect&&g.reflect(d.reflect)}var _="line"===d.geom?"":t.adjust,b=u[d.geom](_),P="MM"===d.pos?l[0]+"*"+l[1]:f[0]+"*"+l[0];if(f.length<2?b.position(s.Stat.summary.sum(P)):b.position(P).color(f[1]),"MMD"===d.pos&&u.line().position(f[0]+"*"+l[1]),d.size&&b.size(d.size),d.scale&&b.scale(1,1),d.shape&&b.shape(d.shape),"area"===d.geom){var x=u.line().position(P).size(2);f.length<2&&x.color(f[1])}if(u.tooltip({crosshairs:!0}),u.legend({itemWrap:!1,position:"bottom"}),this.props.hasOwnProperty("select")&&this.props.select&&(b.selected(!0,{selectedMode:"single",style:{fill:"#fe9929"}}),"tm"!==f[0])){var C=d.pos?l.slice(0,2):[f[0]];u.on("plotclick",function(t){return r.selectHandler(t,C)})}u.render(),this.chart=u},e.prototype.selectHandler=function(t,e){var r=t.shape;if(r){var o=t.geom._attrs.selectedCfg.selectedMode;if(r.get("selected")){var a=r.get("origin"),i=n.pick(a._origin,e);"single"===o?(this.props.select(i,this.lastSelectedShape),this.lastSelectedShape=i):this.props.select(i,null)}else{var a=r.get("origin");this.props.select(null,n.pick(a._origin,e))}}},e.prototype.buildSourceConfig=function(t){var e={},r=c(t.chartType);return t.columns.forEach(function(t){e[t.id]={alias:t.name,type:t.isDim?"cat":"linear"},t.isRate&&(e[t.id].formatter=function(t){return(100*t).toPrecision(3)+"%"})}),t.granularities&&t.granularities.forEach(function(t){t.interval&&(e[t.id]={mask:t.interval>=864e5?"mm-dd":"HH:mm",nice:!0,type:"line"===r.geom?"time":"timeCat"})}),"day"===r.counter&&(e.tm={formatter:function(t){return t>0?"第"+t+"天":"当天"},type:"linear"}),e},e}(a.Component);e.default=u},function(t,r){t.exports=e},function(t,e){t.exports=r},function(t,e){t.exports=o},function(t,e,r){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();e.__esModule=!0;var n=r(2),a=r(3),i=r(8),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.render=function(){var t=this.generateChartParams();return"table"===t.chartType?n.createElement(i.default,{chartParams:t,source:this.context.source,select:this.props.select}):n.createElement(a.default,{chartParams:t,source:this.context.source,select:this.props.select})},e.prototype.generateChartParams=function(){return this.props.hasOwnProperty("chartParams")?this.props.chartParams:{adjust:this.props.adjust,chartType:this.props.chartType,columns:this.context.columns,granularities:this.props.granularities}},e}(n.Component);s.contextTypes={columns:n.PropTypes.array,selectHandler:n.PropTypes.func,selected:n.PropTypes.any,source:n.PropTypes.any},e.default=s},function(t,e,r){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();e.__esModule=!0;var n=r(9),a=r(2),i=r(10),s=r(6),c=function(t){return function(e,r){return e[t]>r[t]?1:-1}},u=function(t,e){return function(r){return r>e?"rgba(255,211,99, "+(r-e)/(t[1]-e)+")":r<e?"rgba(95,182,199, "+(r-e)/(t[0]-e)+")":void 0}},p=function(t,e){return function(t){return{children:t,props:{style:{backgroundColor:e(t)}}}}},l=function(t){return"tm"===t.id?f.formatDate:void 0},f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.formatDate=function(t){return i.unix(t/1e3).format("YYYY-MM-DD")},e.getRowKey=function(t,e){return""+e},e.prototype.render=function(){var t=this.props,r=t.chartParams,o=t.source;if(!o||!r)return null;var i=new s.Frame(o),f=r.columns.map(function(t){return{dataIndex:t.id,key:t.id,render:t.isDim?l(t):p(t,u(s.Frame.range(i,t.id),s.Frame.median(i,t.id))),sorter:c(t.id),title:t.name}});return this.props.hasOwnProperty("extraColumns")&&(f=f.concat(this.props.extraColumns)),a.createElement(n.Table,{dataSource:o,columns:f,pagination:o.length>20&&void 0,rowKey:e.getRowKey})},e}(a.Component);e.default=f},function(t,e){t.exports=n},function(t,e){t.exports=a},function(t,e,r){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();e.__esModule=!0;var n=r(4),a=r(2);e.HttpStatus={Ok:200,Created:201,NoContent:204,MovedPermanently:301,SeeOther:303,NotModified:304,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,RequestTimeout:408,UnsupportedEntity:422,Locked:423,TooManyRequests:429,InternalServerError:500,NotImplemented:501};var i=function(t){function r(e){var r=t.call(this,e)||this;return r.state={columns:null,isLoaded:!1,selected:null,source:null},r}return o(r,t),r.prototype.render=function(){return a.Children.only(this.props.children)},r.prototype.getChildContext=function(){return{columns:this.state.columns,selected:this.state.selected,source:this.state.source}},r.prototype.componentWillReceiveProps=function(t){this.props.params!==t.params&&this.defaultRequest(t.params,this.afterFetch.bind(this))},r.prototype.defaultRequest=function(t,r){var o;o=this.props.hasOwnProperty("sourceUrl")?fetch(this.props.sourceUrl):fetch("/v4/projects/"+project.id+"/chartdata",{body:JSON.stringify(t),credentials:"same-origin",method:"post"}),o.then(function(t){var r=t.status;if(r===e.HttpStatus.Ok)return t.json()}).then(function(t){return r(t)})},r.prototype.componentDidMount=function(){var t=this.props.params;this.defaultRequest(t,this.afterFetch.bind(this))},r.prototype.afterFetch=function(t){var e=t.meta.columns,r=n.map(t.meta.columns,"id"),o=n.map(t.data,function(t){return n.zipObject(r,t)});this.setState({isLoaded:!0,columns:e,source:o}),this.props.onLoad&&this.props.onLoad(this.state)},r}(a.Component);i.childContextTypes={columns:a.PropTypes.array,selectHandler:a.PropTypes.func,selected:a.PropTypes.any,source:a.PropTypes.any},e.default=i}])});